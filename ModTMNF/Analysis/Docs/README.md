## Docs overview

- Files in `Generated.zip` were generated by helper functions in `SymbolsHelper.cs`. These files include info from `TmForever.map` and the in-built class system.
- [DesignPatterns.md](DesignPatterns.md) gives a brief overview of the design patterns used by the game.
- [OtherProjects.md](OtherProjects.md) provides links to other projects.
- [DownloadLinks.md](DownloadLinks.md) provides links to game installers / dedicated servers.
- [Misc.md](Misc.md) contains other miscellaneous bits of information such as interesting call chains.

## Analyzing TMNF

- IDA and OllyDbg are good tools for analyzing and debugging. Use [ida-pro-loadmap](https://github.com/mefistotelis/ida-pro-loadmap) to load `TmForever.map`.
- `TmForever.map` includes symbolic function info which is found in the current version of TMNF.
- `ManiaPlanetLogs.zip` (from TM2 releases, see [DownloadLinks.md](DownloadLinks.md)) includes assertions throught the binary which provide useful info.
- Trackmania has its own custom C++ object system, including [reflection](https://en.wikipedia.org/wiki/Reflective_programming) of native class members via `m_ParamInfos` (of type `SMwParamInfo`) which can be found on every class derived from the base object type `CMwNod`. This reflection info is stored in `CMwClassInfo` which can be obtained by calling the virtual function `CMwNod::MwGetClassInfo` on any object. All classes are included in a linked list inserted via the function call `MwClassLink` (which is called by the `CMwClassInfo::CMwClassInfo` constructor). You can traverse the linked list at address `0xD73BA8`. The functions `CMwNod::MwBuildClassInfoTree` and `CMwClassInfo::FindFromClassName` both use this global.

Other projects contain useful information for getting familiar with TrackMania:

- https://wiki.xaseco.org/wiki/ManiaPlanet_internals (and various pages on this wiki)
- https://github.com/osvein/TMUnlimiter / https://github.com/osvein/TM2Unlimiter
- https://github.com/codecat/maniaplanet-history/blob/master/Openplanet.h
- [OtherProjects.md](OtherProjects.md)

## ModTMNF notes

- C# is used for convenience. There's interop overhead so something like C or C++ would probably be a better choice here if performance is a concern.
- While there is C++ reflection info, I wouldn't advise using it at runtime from C# due to overhead. Manually write code to read at the desired offsets where possible.
- Exceptions from C# will close the game without errors, try/catch where possible (though this wont always work such as some access violations).

## ModTMNF brief overview

- `TrackmaniaLauncher.cs` launches the game in a way that allows hooking of functions prior to full exe load (but suffers from unfixed crash issues).
- `ModTMNF_ManagedLoader.dll` gets injected to the game which loads the .NET runtime in the process.
- `Hook.cs` allows for hooking native functions which are listed under `/Game/AddressTables`.
- `ModTest.cs` is the only "mod". It can simulate the inputs of an existing replay file, and can greatly speed up time to a roughly desired point in the run.
  - NOTE: This wont produce valid runs as it doesn't provide the correct input store events.