## Docs overview

- Files in `Generated` were generated by helper functions in `SymbolsHelper.cs`. These files include info from `TmForever.map` and the in-built class system.
- [DesignPatterns.md](DesignPatterns.md) gives a brief overview of the design patterns used by the game.
- [OtherProjects.md](OtherProjects.md) provides links to other projects.
- [DownloadLinks.md](DownloadLinks.md) provides links to game installers / dedicated servers.
- [Misc.md](Misc.md) contains other miscellaneous bits of information such as interesting call chains.

## Analyzing TMNF

- IDA and OllyDbg are good tools for analyzing and debugging. Use [ida-pro-loadmap](https://github.com/mefistotelis/ida-pro-loadmap) to load `TmForever.map`.
- `TmForever.map` includes symbolic function info which is found in the current version of TMNF.
- `ManiaPlanetLogs.zip` (from TM2 releases, see [DownloadLinks.md](DownloadLinks.md)) includes assertions throught the binary which provide useful info.
- Trackmania has its own custom C++ object system, including [reflection](https://en.wikipedia.org/wiki/Reflective_programming) of native class members via `m_ParamInfos` (of type `SMwParamInfo`) which can be found on every class derived from the base object type `CMwNod`. This reflection info is stored in `CMwClassInfo` which can be obtained by calling the virtual function `CMwNod::MwGetClassInfo` on any object. All classes are included in a linked list inserted via the function call `MwClassLink` (which is called by the `CMwClassInfo::CMwClassInfo` constructor). You can traverse the linked list at address `0xD73BA8`. The functions `CMwNod::MwBuildClassInfoTree` and `CMwClassInfo::FindFromClassName` both use this global.

Other projects contain useful information for getting familiar with TrackMania:

- https://wiki.xaseco.org/wiki/ManiaPlanet_internals (and various pages on this wiki)
- https://github.com/osvein/TMUnlimiter / https://github.com/osvein/TM2Unlimiter
- https://github.com/codecat/maniaplanet-history/blob/master/Openplanet.h
- [OtherProjects.md](OtherProjects.md)

## ModTMNF notes

- The motivation for creating this project was to make new single player content. For anything involving online play I'd advise first emulating the master server and creating your own completely seperate place for modifications.
- C# is mostly used for convenience. There's interop overhead so something like C or C++ would probably be a better choice here if performance is a concern.
- Feel free to make a PR for a *seperate* newer `.sln`. But do not break `ModTMNF.sln`, `ModTMNF.csproj`, or the ability to compile with VS2010 (C# 4.0).
- Design patterns in this project are subject to change and there may be large structural changes.
- While there is C++ reflection info, I wouldn't advise using it at runtime from C# due to overhead. Manually write code to read at the desired offsets where possible.
- Exception from C# will close the game without errors, try/catch where possible (though this wont always work such as some access violations).

## TODO

- Add function to hook VTable entries (multiple classes / single class) VT.Hook(entryIndex, type) / VT.HookAll(entryIndex, typeArray)
- Implement more of the `Classic` classes, and finish the current implementations (especially array access).
- Implement more essential classes / finish current implementations.
- Document interesting functions / interactions / call chains.
- Start working on some type of modding project so that more functionality gets added.